# ============================================
# Metalogics Backend API - Environment Variables
# ============================================
# Copy this file to .env and fill in your actual values
# NEVER commit .env to version control!

# ============================================
# SERVER CONFIGURATION
# ============================================

# Environment: development, staging, production, test
NODE_ENV=development

# Port number for the API server
PORT=3000

# Base URL for the API (optional, defaults to http://localhost:PORT)
# API_BASE_URL=http://localhost:3000

# Request timeout in milliseconds (default: 30000 = 30 seconds)
REQUEST_TIMEOUT=30000

# ============================================
# DATABASE CONFIGURATION
# ============================================

# PostgreSQL connection string
# Format: postgresql://username:password@host:port/database
# Example: postgresql://postgres:password@localhost:5432/metalogics_bookings
DATABASE_URL=postgresql://user:password@localhost:5432/metalogics_bookings

# Maximum number of database connections in the pool (default: 20)
DATABASE_POOL_SIZE=20

# Database connection timeout in milliseconds (default: 10000 = 10 seconds)
DATABASE_CONNECTION_TIMEOUT=10000

# Database query timeout in milliseconds (default: 10000 = 10 seconds)
DATABASE_QUERY_TIMEOUT=10000

# ============================================
# EMAIL CONFIGURATION
# ============================================

# SMTP server hostname
# Examples:
#   - Gmail: smtp.gmail.com
#   - SendGrid: smtp.sendgrid.net
#   - Mailgun: smtp.mailgun.org
SMTP_HOST=smtp.gmail.com

# SMTP server port
# Common ports:
#   - 587 (TLS/STARTTLS - recommended)
#   - 465 (SSL)
#   - 25 (unencrypted - not recommended)
SMTP_PORT=587

# SMTP authentication username (usually your email address)
SMTP_USER=your-email@gmail.com

# SMTP authentication password
# For Gmail: Use an App Password (not your regular password)
# Generate at: https://myaccount.google.com/apppasswords
SMTP_PASSWORD=your-app-password

# Administrator email address (receives booking notifications)
ADMIN_EMAIL=admin@metalogics.io

# Email address to send from (optional, defaults to SMTP_USER)
FROM_EMAIL=noreply@metalogics.io

# Name to display in the "From" field (default: Metalogics AI Assistant)
FROM_NAME=Metalogics AI Assistant

# Number of retry attempts for failed email sends (default: 3)
EMAIL_RETRY_ATTEMPTS=3

# Initial delay between email retry attempts in milliseconds (default: 2000 = 2 seconds)
# Uses exponential backoff: 2s, 4s, 8s
EMAIL_RETRY_DELAY=2000

# ============================================
# AUTHENTICATION & SECURITY
# ============================================

# API key for authenticating write operations (POST, PUT, PATCH, DELETE)
# IMPORTANT: Generate a strong, random key (minimum 32 characters)
# You can generate one using: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
API_KEY=your-secure-api-key-min-32-characters-long

# Header name for API key authentication (default: Authorization)
# Expected format: Authorization: Bearer <API_KEY>
API_KEY_HEADER=Authorization

# ============================================
# LOGGING CONFIGURATION
# ============================================

# Log level: error, warn, info, debug
# Recommended:
#   - development: debug
#   - staging: info
#   - production: info or warn
LOG_LEVEL=info

# Path to log file (optional)
# If not set, logs will only go to console
# Example: ./logs/app.log
LOG_FILE_PATH=./logs/app.log

# Enable console logging (default: true)
LOG_ENABLE_CONSOLE=true

# Enable file logging (default: false in dev, true in production)
LOG_ENABLE_FILE=false

# Maximum size of each log file before rotation (default: 20m)
# Examples: 10m, 20m, 100m, 1g
LOG_MAX_FILE_SIZE=20m

# Maximum number of days to keep log files (default: 14d)
# Examples: 7d, 14d, 30d, 90d
LOG_MAX_FILES=14d

# ============================================
# RATE LIMITING
# ============================================

# Time window for rate limiting in milliseconds (default: 60000 = 1 minute)
RATE_LIMIT_WINDOW_MS=60000

# Maximum number of requests per IP address per time window (default: 100)
RATE_LIMIT_MAX_REQUESTS=100

# Skip counting successful requests (default: false)
RATE_LIMIT_SKIP_SUCCESSFUL=false

# ============================================
# CORS CONFIGURATION
# ============================================

# Comma-separated list of allowed origins
# Examples:
#   - Development: http://localhost:5173
#   - Production: https://metalogics.io,https://www.metalogics.io
ALLOWED_ORIGINS=http://localhost:5173

# Comma-separated list of allowed HTTP methods (default: GET,POST,PUT,PATCH,DELETE)
ALLOWED_METHODS=GET,POST,PUT,PATCH,DELETE

# Comma-separated list of allowed headers (default: Content-Type,Authorization)
ALLOWED_HEADERS=Content-Type,Authorization

# Allow credentials (cookies, authorization headers) (default: true)
CORS_CREDENTIALS=true

# Maximum age for CORS preflight cache in seconds (default: 86400 = 24 hours)
CORS_MAX_AGE=86400

# ============================================
# GOOGLE CALENDAR CONFIGURATION
# ============================================

# Enable/disable Google Calendar integration (default: false)
GOOGLE_CALENDAR_ENABLED=false

# Service account email address (from Google Cloud Console)
# Example: booking-system@your-project.iam.gserviceaccount.com
GOOGLE_SERVICE_ACCOUNT_EMAIL=

# Path to service account JSON key file
# Example: ./config/google-service-account.json
GOOGLE_SERVICE_ACCOUNT_KEY_PATH=

# Calendar ID to use (usually email address of calendar, or "primary" for main calendar)
GOOGLE_CALENDAR_ID=primary

# Timezone for calendar operations (IANA timezone format)
# Examples: Europe/London (UK), Asia/Karachi (Pakistan), America/New_York
GOOGLE_CALENDAR_TIMEZONE=Europe/London

# Number of retry attempts for failed calendar API calls (default: 3)
GOOGLE_CALENDAR_RETRY_ATTEMPTS=3

# Initial delay between retry attempts in milliseconds (default: 1000 = 1 second)
# Uses exponential backoff: 1s, 2s, 4s
GOOGLE_CALENDAR_RETRY_DELAY=1000

# ============================================
# HUBSPOT CRM CONFIGURATION
# ============================================

# Enable/disable HubSpot integration (default: false)
HUBSPOT_ENABLED=false

# HubSpot private app access token
# Generate at: Settings > Integrations > Private Apps
# Required scopes: crm.objects.contacts.read, crm.objects.contacts.write
HUBSPOT_ACCESS_TOKEN=

# Number of retry attempts for failed HubSpot API calls (default: 3)
HUBSPOT_RETRY_ATTEMPTS=3

# Initial delay between retry attempts in milliseconds (default: 1000 = 1 second)
# Uses exponential backoff: 1s, 2s, 4s
HUBSPOT_RETRY_DELAY=1000

# ============================================
# BOOKING RULES CONFIGURATION
# ============================================

# DEPRECATED: General frequency limits (not used - only duration-specific rules apply)
# These are kept for backward compatibility but have no effect
MAX_BOOKINGS_PER_EMAIL=999
FREQUENCY_WINDOW_DAYS=999

# Duration-specific frequency rules (hardcoded in config):
# - 15-min meetings: Max 2 bookings within 90-minute rolling window
# - 30-min meetings: Max 2 bookings within 3-hour rolling window
# - 45-min meetings: Max 2 bookings within 5-hour rolling window
# - 60-min meetings: Max 2 bookings within 12-hour rolling window

# Business days (0=Sunday, 1=Monday, ..., 6=Saturday)
# Default: 1,2,3,4,5 (Monday-Friday)
BUSINESS_DAYS=1,2,3,4,5

# Business hours - start hour in 24-hour format (default: 9 = 9 AM)
BUSINESS_START_HOUR=9

# Business hours - end hour in 24-hour format (default: 17 = 5 PM)
BUSINESS_END_HOUR=17

# Timezone for business hours (IANA timezone format)
# Use Europe/London for UK or Asia/Karachi for Pakistan
BUSINESS_TIMEZONE=Europe/London

# Buffer time between consecutive bookings in minutes (default: 15)
BUFFER_MINUTES=15

# Minimum advance booking time in hours (default: 1)
# Prevents bookings less than this many hours in the future
MIN_ADVANCE_HOURS=1

# Maximum advance booking time in hours (default: 24)
# Prevents bookings more than this many hours in the future
MAX_ADVANCE_HOURS=24

# ============================================
# GEMINI AI CONFIGURATION
# ============================================

# Google Gemini API key for intelligent chat responses
# Get your API key from: https://makersuite.google.com/app/apikey
GEMINI_API_KEY=your-gemini-api-key-here

# ============================================
# ENVIRONMENT-SPECIFIC EXAMPLES
# ============================================

# --- DEVELOPMENT ---
# NODE_ENV=development
# PORT=3000
# DATABASE_URL=postgresql://postgres:password@localhost:5432/metalogics_dev
# LOG_LEVEL=debug
# ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000
# GOOGLE_CALENDAR_ENABLED=false
# HUBSPOT_ENABLED=false

# --- STAGING ---
# NODE_ENV=staging
# PORT=3000
# DATABASE_URL=postgresql://user:password@staging-db.example.com:5432/metalogics_staging
# LOG_LEVEL=info
# LOG_ENABLE_FILE=true
# ALLOWED_ORIGINS=https://staging.metalogics.io
# GOOGLE_CALENDAR_ENABLED=true
# HUBSPOT_ENABLED=true

# --- PRODUCTION ---
# NODE_ENV=production
# PORT=3000
# DATABASE_URL=postgresql://user:password@prod-db.example.com:5432/metalogics_prod
# LOG_LEVEL=warn
# LOG_ENABLE_FILE=true
# ALLOWED_ORIGINS=https://metalogics.io,https://www.metalogics.io
# RATE_LIMIT_MAX_REQUESTS=50
# GOOGLE_CALENDAR_ENABLED=true
# HUBSPOT_ENABLED=true
